<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="layout" th:with="title='daily-recommend'">

<div layout:fragment="content" class="container" style="background-color: #FFFFFF;">
    <div class="container">
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Gamja+Flower&display=swap" rel="stylesheet">
        <style>
            h2{
                font-family: 'Gamja Flower', cursive;
                font-size: 40px;
            }
            tr, td, th, img ,p, span{
                font-family: 'Gamja Flower', cursive;
                font-size: 25px;
            }


        </style>



        <!--현재 날씨-->
        <div class="row">
            <h1> </h1>
            <!--날씨 아이콘-->
            <div id="loadWeatherIcon">....</div>
            <!--현재 온도-->
            <span id="loadWeather">현재 날씨 로드중...</span>
            <!--시계-->
            <span id="clock">00:00</span>
            <!--현위치 주소-->
            <span id="full_address">현재 위치 로드중...</span>


<!--            <div th:each="weather:${currentTemperature}">-->
<!--                <span id="weather_view1" th:text="${weather.localWeather}" ></span>-->
<!--                <span id="weather_view2" th:text="${weather.meridiem}  " ></span>-->
<!--                <span id="weather_view3" th:text="${weather.temperature}"></span>-->
<!--            </div>-->
<!--            <div th:each="clothes_outer:${outer}">-->
<!--                <span th:text="${clothes_outer.url}"></span>-->
<!--            </div>-->
            <h1> </h1>
        </div>
<hr style="color: #FFFFFF">
        <div class="row">
            <h1> </h1>
            <div class="col-md-2"></div>
            <div class="col-md-8">
                <h2>오늘 이 옷은 어떨까요?</h2>
                <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-indicators">
                        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
                        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
                    </div>
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <img th:src="@{${outer.mainUrl}}" class="d-block w-100" alt="1번 이미지">
                        </div>
                        <div class="carousel-item">
                            <img th:src="@{${top.mainUrl}}" class="d-block w-100" alt="2번 이미지">
                        </div>
                        <div class="carousel-item">
                            <img th:src="@{${bottom.mainUrl}}" class="d-block w-100" alt="3번 이미지">
                        </div>
                    </div>
                    <button class="carousel-control-prev" style="background-color: whitesmoke" type="button" onclick="$('#carouselExampleIndicators').carousel('prev')" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" style="background-color: whitesmoke" onclick="$('#carouselExampleIndicators').carousel('next')" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </div>
            <div class="col-md-2"></div>
        </div>
<hr>
        <div class="row">
            <h2>요일별 날씨</h2>
<!--            &lt;!&ndash;지역 날씨 검색&ndash;&gt;-->
<!--            <div class="row">-->
<!--                <div class="col-md-2"></div>-->
<!--                <div class="col-md-8">-->
<!--                    <label for="city"><b>City :</b></label>-->
<!--                    <input class="w-25" id="city" type="text" placeholder="검색하고 싶은 도시를 입력해주세요.">-->
<!--                    <div>-->
<!--                        <button type="button" class="btn btn-light" id="btn-weatherList">조회</button>-->
<!--                    </div>-->
<!--                </div>-->
<!--                <div class="col-md-2"></div>-->
<!--            </div>-->
            <!--현재위치 조회 버튼-->
            <div class="row">
                <div class="col-md-4">
                    <button id="locationBtn" class="w-10 btn btn-dark btn">Search my location</button>
                </div>
                <div class="col-md-4">
                </div>
                <div class="col-md-4">
                </div>
            </div>
            <table class="table table-horizontal table-bordered">
                <thead class="thead-strong">
                <tr align="center">
                    <th>날짜</th>
<!--                    <th>지역</th>-->
                    <th>예보</th>
                    <th>오전/오후</th>
                    <th>온도</th>
                </tr>
                </thead>
                <tbody id="weatherList">
                <tr th:each="weather:${weatherList}" align="center">
                    <td th:text="${weather.baseDate}"></td>
<!--                    <td th:text="${weather.city}"></td>-->
                    <td th:text="${weather.localWeather}"></td>
                    <td th:text="${weather.meridiem}"></td>
                    <td th:text="${weather.temperature}"></td>
                </tr>
                </tbody>
            </table>

        </div>


    </div>

    <!--시계 스크립트-->
    <script>
        var clockTarget = document.getElementById("clock");
        function clock() {
            var date = new Date();
            var month = date.getMonth();
            var clockDate = date.getDate();
            var day = date.getDay();
            var week = ['일', '월', '화', '수', '목', '금', '토'];
            var hours = date.getHours();
            var minutes = date.getMinutes();
            var seconds = date.getSeconds();
            clockTarget .innerText = `${month+1}월 ${clockDate}일 ${week[day]}요일` +
                `${hours < 10 ? `0${hours}` : hours}:${minutes < 10 ? `0${minutes }`  : minutes }:${seconds < 10 ? `0${seconds }`  : seconds }`;
            // 월은 0부터 1월이기때문에 +1일
            // 시간 분 초는 한자리수이면 시계가 어색해보일까봐 10보다 작으면 앞에0을 붙혀주는 작업을 3항연산으로
        }
        function init() {
            clock();
// 최초에 함수를 한번 실행시켜주고
            setInterval(clock, 1000);
// setInterval이라는 함수로 매초마다 실행
// 1000 = 1초
        }
        init();
    </script>
    <!--현재 위치값(좌표,주소값) 스크립트 -->
    <script>
        const KEY ="AIzaSyBRIdueEX0Qeqz8Wyztxks_rSof_IdTNWM";
        //const OpenWeatherKey = "32dfb5f4525c5b244a15ba405f09c370";

        // $("#locationBtn").click(function(){
            // e.preventDefault();
       // $("#locationBtn").click(function(){
            let url;
            let city;
            let city_address;
            let city_adress2;
            var full_address = document.getElementById("full_address")

        navigator.geolocation.getCurrentPosition(function(pos) {
            var latitude = pos.coords.latitude;
            var longitude = pos.coords.longitude;
            url = "https://maps.googleapis.com/maps/api/geocode/json?latlng="+latitude+","+longitude+"&key="+KEY;

            console.log("lat: "+latitude+", lng:"+longitude);

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    //console.log(data);
                    let parts = data.results[0].formatted_address
                    city = parts.split(" ")[1];
                    city_address = parts.split(" ")[2]; // ex) 마포구
                    city_adress2 = parts.split(" ")[3]; // ~~1가
                    full_address.innerText = city + " " + city_address + " " +city_adress2;
                    console.log(city+" fetch");

                    $("#locationBtn").click(function() {
                        window.location.href = '/daily-recommend?city=' + city;//
                    });
                });
        });
     //   });
     //   $("#locationBtn").click(function(){
     //        e.preventDefault();
     //        console.log(city+" ajax");
     //        let geolocation = {city};
     //        $.ajax({
     //            url : "/daily-recommend",
     //            type : "GET",
     //            data : geolocation,
     //            success : function(data) {
     //                // alert(data);
     //            },
     //        })//ajax
     //   // });
     //    });


    </script>


    <script>
        //openWeatherMap 으로 오늘 실시간 날씨 + 아이콘 받기
        const OpenWeatherKey = "32dfb5f4525c5b244a15ba405f09c370";
        var currentWeather = document.getElementById("loadWeather");
        var loadWeatherIcon = document.getElementById("loadWeatherIcon");

            navigator.geolocation.getCurrentPosition(function (pos) {
                var latitude = pos.coords.latitude;
                var longitude = pos.coords.longitude;
                let openWeatherUrl = "http://api.openweathermap.org/data/2.5/weather?lat="+latitude+"&lon="+longitude+"&appid="+OpenWeatherKey;

                console.log("체크용 222 lat: "+latitude+", lng:"+longitude);
                fetch(openWeatherUrl)
                    .then(response => response.json())
                    .then(data => {
                       // console.log(data);
                        console.log("현재온도 : "+ (data.main.temp- 273.15) );
                        console.log("현재습도 : "+ data.main.humidity);
                        console.log("날씨 : "+ data.weather[0].main );
                        console.log("상세날씨설명 : "+ data.weather[0].description );
                        console.log("날씨 이미지 : "+ data.weather[0].icon );
                        console.log("바람   : "+ data.wind.speed );
                        console.log("나라   : "+ data.sys.country );
                        console.log("도시이름  : "+ data.name );
                        console.log("구름  : "+ (data.clouds.all) +"%" );

                        let temperature = Math.floor(data.main.temp- 273.15);
                        let weather = data.weather[0].main;
                        let weatherDetail = data.weather[0].description;
                        //let image = data.weather[0].icon;
                        let icon = "http://openweathermap.org/img/w/"+data.weather[0].icon+".png";
                        currentWeather.innerText = temperature +"°C";
                        loadWeatherIcon.innerHTML="<img src='"+ icon+"' height='230' width='280'>"

                    });

                // $.ajax({
                //     url: "/daily-recommend",
                //     dataType: "json",
                //     type: "GET",
                //     async: "false",
                //     success: function(resp) {
                //         console.log(resp);
                //         console.log("현재온도 : "+ (resp.main.temp- 273.15) );
                //         console.log("현재습도 : "+ resp.main.humidity);
                //         console.log("날씨 : "+ resp.weather[0].main );
                //         console.log("상세날씨설명 : "+ resp.weather[0].description );
                //         console.log("날씨 이미지 : "+ resp.weather[0].icon );
                //         console.log("바람   : "+ resp.wind.speed );
                //         console.log("나라   : "+ resp.sys.country );
                //         console.log("도시이름  : "+ resp.name );
                //         console.log("구름  : "+ (resp.clouds.all) +"%" );
                //     }
                // })
            });

    </script>


</div>
</div>
<!--<script>-->
<!--    var main = {-->
<!--        init : function () {-->
<!--            var _this = this;-->
<!--            $('#btn-weatherList').on('click', function () {-->
<!--                _this.weatherList();-->
<!--            });-->
<!--        },-->
<!--        weatherList : function () {-->
<!--            var data = {-->
<!--                baseDate: $('#baseDate').val(),-->
<!--                meridiem: $('#meridiem').val(),-->
<!--                city: $('#city').val(),-->
<!--                temperature: $('#temperature').val(),-->
<!--                localWeather: $('#localWeather').val()-->
<!--            };-->
<!--            $.ajax({-->
<!--                type: 'get',-->
<!--                url: '/weather/weatherList?city='+data.city,-->
<!--                // dataType: 'json',-->
<!--                // contentType: 'application/json; charset=utf-8',-->
<!--                // data: JSON.stringify(data),-->
<!--                cache: false-->
<!--            }).done(function (fragment) {-->
<!--                $('#weatherList').replaceWith(fragment);-->
<!--                alert("날씨 조회에 성공했습니다.")-->
<!--            }).fail(function (error) {-->
<!--                alert(JSON.stringify(error));-->
<!--            });-->
<!--        }-->
<!--    };-->
<!--    main.init();-->

<!--</script>-->

</html>